# 작업 / 사고의 모듈화

- PM이 CI-CD workflow 짜고 있는데 작업 단위가 너무 크고 체계화되어 있지 않은 채로 GPT에 의존하고 있음
- workflow 전체 구조 짜는 것부터 GPT한테 시켜 놓으니, 만들어놓지도 않은 healthcheck 엔드포인트를 호출해서 오류가 나는 황당한 상황이 발생
- 코드를 쓸 때 모듈화가 필요한 것처럼, 작업 계획과 우리의 사고도 모듈화하고, 전체 작업을 작은 단위로 분화하여 수행해나가야 함을 강조하고자 함



## Case Study

※ 참고 : 이전에 공유드렸던 `How_to_ask.md`의 AI 활용법 관련 내용과 함께 보시면 더 좋을 것 같습니다.



##### 지금 하고 계신 작업, CI-CD 워크플로우 작성을 모듈화해봅시다.

- 조건 설정
  - workflow 발동 trigger event가 무엇인지 정의
  - 어느 브랜치에 push(또는 pr)이 일어날 때 어떤 workflow가 작동해야 할까?

- CI

  - ruff를 통한 python 문법 check / fix
  - 추후 다른 언어 linting tool 추가 가능

- CD

  - 필요한 환경 변수 정의
    - Github CI/CD 서버에서는 Github Secrets를 그대로 활용
    - EC2 인스턴스에서는 Github Secrets를 기반으로 작성한 .env 활용
  - Docker Image Build
  - Docker Image Push to DockerHub
  - EC2 인스턴스에서 Image Pull
  - Docker-compose로 컨테이너 3개 동시에 실행
    - Nginx
    - Django 웹 서버
    - MySQL DB 서버

  - 설정 파일 수정
  - healthcheck

  

##### 한두 스텝 더 깊게, 세부적으로 작성할 수도 있겠지만 크게 위와 같은 흐름이 되겠죠.

##### 이런 설계와 맥락을 담지 않고 GPT에게 yml 파일 작성을 맡겨 놓으면, 개발자의 의도와는 전~혀 상관 없는 일반적인 CI-CD 워크플로우를 제 멋대로 짭니다.

##### 개발 과정에서 내 의도와 상관 없는 동작, 내 의도와 상관 없는 오류가 자꾸 일어나면 서비스가 커질수록 통제할 수 없는 범위가 넓어지고 결국 스스로 해결할 수 없는 문제를 일으키게 됩니다.

##### 때문에 GPT는 내가 시킨 작업(주로 코드 작성)을 하는 도구로서만 활용되어야 하고, 그 이전에 구조 설계는 '내가' 꽉 잡고 있어야만 하는 것입니다.

##### 위에서 모듈화한 작업 흐름을 가지고 GPT를 활용해봅시다. 활용 단계는 대체로 아래와 비슷할 겁니다. 

- 질문 1 : 앞으로 할 작업들을 명세화하고 GPT가 이해할 수 있도록 전달

```markdown
GPT야, 내가 github actions로 CI-CD를 구현해볼건데, 3개의 컨테이너(Django 웹서버, Nginx, MySQL)가 EC2 인스턴스 안에서 각각 실행되어 하나의 웹 서비스를 이루도록 할거야. 내가 지금까지 작성한 CI-CD workflow는 다음과 같아. 전체적으로 검토해서 잘못됐거나 빠진 내용이 없는지 알려줘.

(위에 작성한 workflow 내용 전체)
```

- 질문 2 : 정의해놓은 workflow의 순서대로, 세부사항 결정

```markdown
CI랑 CD를 구분해야 하나? 개발 단계에서 dev 브랜치에 운영 도메인까지 연결해놓을 거라서 dev 브랜치에 push가 일어나는 것을 trigger로 해서 전체 워크플로우가 실행되도록 하려고 했는데, pull-request가 일어날 때 CI 워크플로우만 실행을 하고 push가 일어날 때 CD 워크플로우가 실행되도록 파일을 분리해야 하는지, 아니면 push trigger에 하나의 CI-CD 전체 워크플로우가 실행되어도 상관 없는 건지 궁금해.
```

- 질문 3 : **작은 모듈 단위로** 코드 작성

```markdown
아하, 그럼 그렇게 코드 구성해주고 내가 이해할 수 있게 행마다 세부적으로 주석 달아줘. 한 번에 전체 코드를 작성하지 말고, CI에서 ruff 모듈로 코드 linting하는 부분만 써줘.
```

- 질문 4 : 작성한 코드 검수, 주석 및 세부사항 **내가 직접 수정**한 후 재검토 요청

```markdown
이 부분 코드 이해가 안 가.
이 부분 이런 식으로 쓴 이유가 뭐야?
라이브러리 버전 이 버전으로 쓴 이유는 뭐야?
내가 어떤 이유로 이렇게 코드 바꿔봤는데 어때?
```

##### 위와 같은 과정을 설계해둔 작업 단위별로 반복해나가시면 됩니다.

##### 전체 작업에 대한 개발자의 이해도에 따라 작업 단위의 크기도 달라질 수 있고

##### GPT 활용 단계도 더 복잡하거나 단순해질 수 있겠지만

##### Top-Down 방식으로 작업 단위를 나누고 단위별로 수행해야 한다는 사실은 변하지 않습니다.

##### CI-CD는 상대적으로 독립적으로 작동하는 프로세스라 문제가 덜 하겠지만, 실제로 앱 기능을 개발할 때 당장 일을 빨리 끝내기 위해 내가 이해하지도 못한 코드를 써놓고, 당장 그게 동작한다고 읽지도 않고 넘어가면..

##### 작동하고 있는 서비스와 기능들 사이에 내가 모르는 코드가 섞여 들어가서 숨어 있다가, 어느 순간 전체 서비스의 논리 구조를 해치고 절~~~~대 못 고치는 이상한 버그를 만들어냅니다.

##### 많은 시행착오가 필요하겠지만, 좋은 습관을 만들어가기 위해 이러한 문제를 항상 의식적으로 인식하고 점검하셔야 합니다.



### 세 줄 요약

- 큰 작업을 한 번에 AI에게 맡기지 말고, **설계도**를 먼저 그리고 잘게 쪼갠다.
- 쪼갠 작업 단위 하나씩 AI와 함께 해결하며, 코드를 내 것으로 만든다.
- 이해하지 못한 코드는 시한폭탄이다.