# EC2



## 선수 지식

- Python 기초 구문 및 pip 사용법
- CLI에 대한 이해



## 학습 목표

- IAM 계정으로 로그인하여 EC2 인스턴스를 생성 및 종료할 수 있다.
- 키 페어를 발급받아 안전하게 관리할 수 있다.
- 최소 권한 원칙에 따라 보안 그룹을 적절하게 설정할 수 있다.
- MobaXterm을 통해 EC2 인스턴스에 SSH접속할 수 있다.
- Docker 명령어를 통해 EC2 터미널에서 이미지 및 컨테이너를 조작할 수 있다.



## Warm-up

- EC2는 AWS에서 제공하는 VM 클라우드 서비스입니다.
- 사용자 입장에서 가장 쉽게 이해하자면, 지정된 OS만 깔린 가상 컴퓨터 한 대를 빌려준다고 생각하면 됩니다.
- 모든 인프라 서비스의 기반이 되는, AWS에서 가장 중요한 서비스입니다.



## 이론

### 인스턴스란?

- EC2 서비스에서 빌린 VM 하나하나를 칭함

- 사용자가 선택한 설정(OS, 저장공간, RAM, GPU, 네트워크 설정 등)을 바탕으로 만든 가상 컴퓨터 공간

- free-tier에서는 t2.micro 또는 t3.micro처럼 사양이 낮은 서버를 사용할 것



### 인스턴스 중지 | 종료

- 인스턴스 중지(stop)
  - 컴퓨터를 끄는 것과 같음
  - os는 돌아가지 않으니까 ec2 사용료는 내지 않지만, 저장소인 EBS에 대한 비용은 계속 부과
  - 중지했다가 다시 시작하면 ip주소는 바뀌지만 서버는 복구됨

- 인스턴스 종료(terminate)

  - 모든 데이터 삭제 및 접근 불가, 복구도 불가


  - 종료해도 수 분~수 시간동안 목록에 뜨지만 다 정리되고 나면 자동으로 목록에서 사라짐



### 보안 설정

#### 1. pem key

- EC2 서버에 SSH 접속(터미널에 접근)하기 위한 비공개 key
- 분실하면 해당 인스턴스에 다시는 접속할 수 없음
  - 접속은 못하지만 EBS는 따로 다른 인스턴스에 attach해서 데이터 자체는 살려낼 수 있음

- 당연히 .gitignore에 추가할 것. 혹시라도 git이나 다른 경로를 통해 유출되면 즉시 폐기해야 함

##### ※ Key pair라고 부르는 이유?

- key는 public key와 private key로 나뉘어 있음
- public key는 EC2 인스턴스 내부에 저장되고 private key는 `.pem`파일로 발급됨
- 자물쇠와 열쇠의 관계처럼 서로 맞춰보는 방식으로 인증이 이루어지기 때문에 pair라고 칭하는 것



#### 2. 보안 그룹

- ec2 서버에 붙는 가상 방화벽. 어떤 트래픽을 허용할지 설정하는 규칙의 집합

##### 인바운드 규칙

- 인스턴스 밖에서 안으로 들어오는 트래픽에 대한 규칙
- 기본값은 아무 포트도 열려있지 않음
- ssh 접속 : 터미널 접근(PORT 22)
- 웹 서버 접속 : http(PORT 80), https(PORT 443)



##### 아웃바운드 규칙

- 인스턴스 안에서 밖으로 나가는 트래픽에 대한 규칙
- 기본값은 모든 포트가 열려 있음
- 패키지 설치, 외부 API 호출 등



## 실습

- MobaXterm 설치
  - https://github.com/srogsrogi/TIL/blob/master/Lesson/how_to_install/mobaxterm.md
  
- EC2 인스턴스 만들기
  - region 설정
  - AMI, 인스턴스 유형 지정
  - 키 페어 발급
  - 보안 그룹 설정
  - storage volume 설정
  - 인스턴스 개수 설정
- 인스턴스 정보 둘러 보기
  - IPv4 주소
  - 모니터링
  - 보안 그룹 설정

- 기타 사이드바 메뉴
  - EBS
  - load balancing / auto-scaling
  - AMI

- MobaXterm으로 SSH 접속
  - 사이드바 활용
  - 하단 실시간 리소스 사용량 확인
  - sudo su
  - apt update
- EC2 인스턴스 터미널에서 docker 조작
  - apt install docker.io
  - docker login
  - docker pull
  - docker image ls
  - docker run
  - docker ps
  - docker logs



## Wrap-up Quiz

- 여러분의 프로젝트에서 AWS EC2를 활용한 이유는 무엇인가요?
- 보안 그룹에서 설정하는 인바운드 규칙의 의미는 무엇인가요?
- AWS 서버로 접속하기 위한 주소는 무엇이고, 어디에서 확인할 수 있나요?



## 강의 마무리

- 드디어! 여러분이 개발 중 서버 쪽에서 오류가 발생했을 때, 직접 접속해서 서버에 찍히는 오류 로그를 확인할 수 있게 되었습니다.
- 앞으로 프로젝트를 진행하면서 아래 작업들을 많이 경험해보며 클라우드 환경 활용에 익숙해지시기 바랍니다.
  - EC2 인스턴스에 대한 SSH 접속
  - Linux CLI를 통한 서버 컴퓨터 및 앱 제어
  - Docker 앱을 통한 컨테이너 로그 확인 및 컨테이너 내부 터미널 접속
- PORT의 개념이 다소 추상적이라 오늘은 깊게 설명하지 않았고, 온전히 이해하기는 어려우셨으리라 생각합니다. PORT 설정의 동작 방식에 대해 추가학습해보셔도 좋고, 이후 오프라인 강의 때 기회가 되면 다시 짚어드리겠습니다.

- 다음 시간에는 EC2 인스턴스의 IPv4 주소에 이름(도메인 주소)을 붙여 주는 DNS에 대해 배워보겠습니다.



## 수강생 피드백



## 소감

- 첫 날에 비하면 훨씬 수월했다. 말도 잘 나오고 화면 공유 환경도 더 익숙해짐
- 내용 자체가 꽤 많은데 두 시간 안에 꾸겨넣느라 말이 좀 빨라졌던 것 같다. 몇% 정도 이해하셨을지 모르겠다.