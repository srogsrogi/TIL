# Container와 Docker



## 선수 지식

- Python 기초 구문 및 pip 사용법

- CLI에 대한 이해



## 학습 목표

- 가상화 기술인 VM과 Container를 비교하여 설명할 수 있다.
- 로컬 환경 내에서 `Image build | push | pull` -> `Container run`의 과정을 실행할 수 있다.
- Docker 명령어를 사용하여 이미지와 컨테이너의 상태 및 로그를 확인할 수 있다.



## Warm-up

- 가상 환경을 통한 환경 격리는 OS가 다를 때 재현성을 보장하지 못한다고 배웠습니다.

- 다른 개발자나 서버 컴퓨터에서 완전한 재현성을 보장하려면, OS 환경까지 통일할 필요가 있습니다.
- 이번 시간에는 OS 레벨의 가상화 기술인 Container와 Container의 구현 도구인 Docker를 학습합니다.



## 이론

### 가상화(Virtualization)란?

- 물리적 컴퓨터 리소스를 추상화하여 여러 개의 가상화 소프트웨어를 만드는 기술
- 만들어진 가상화 소프트웨어 간에는 논리적 독립성이 보장됨
- 리소스 효율성을 증가시키고, 클라우드 컴퓨팅의 기반이 됨
- 대표적인 하위 개념으로 **VM | Container**가 있음



### VM | Container 비교

| 구분          | VM(Virtual Machine)         | **Container**                  |
| ------------- | --------------------------- | ------------------------------ |
| **개념**      | 하드웨어 수준 가상화        | OS 수준 가상화                 |
| **구성 요소** | Guest OS + App + 라이브러리 | App + 라이브러리(Host OS 공유) |
| **시작 속도** | 느림(보통 수십 초 이상)     | 빠름(보통 수 초 이내)          |
| **격리 수준** | 강력(완전한 OS 단위 분리)   | 중간(프로세스 단위 격리)       |
| **유지보수**  | 어려움(OS마다 패치 필요)    | 쉬움(이미지 기반 관리)         |

#### ※ 주의

- VM과 Container는 둘 중에 하나만 써야 하는, 배타적인 개념이 아님
- VM과 Container의 정의나 특징을 비교하며 공부하는 경우가 많아 이런 오해가 생기는 경우가 있음
- 오히려 VM 안에서 Container를 사용하며 보완적으로 활용하게 됨



### Docker 주요 개념

#### Docker

- Container 기술을 기반으로 **앱 실행 환경을 격리**하고 관리하는 도구

- OS 레벨의 가상화를 통해 동일한 OS 안에 있는 각 앱의 실행 공간을 논리적으로 분리

#### Image

- 애플리케이션 실행을 위해 필요한 소스 코드, 라이브러리, 설정 파일 등의 환경을 모두 포함한 스냅샷
- Container를 만들기 위한 설계도

#### DockerHub

- 만들어진 Image를 저장 및 공유할 수 있는 원격 저장소
- `tag`를 통해 Image를 구분하고 버전을 관리



### Docker의 특징

- 동일한 OS 환경을 가정하기 때문에 가볍고 빠르면서도 실행이 안정적

- 같은 파일, 라이브러리 등을 사용하는 경우 기존에 저장돼있는 이미지/컨테이너의 것을 마운트하여 사용하기 때문에 리소스를 효율적으로 사용

- 컨테이너 단위로 테스트/배포할 수 있어 CI/CD환경 구축에 용이

- 인프라를 코드 기반으로 관리할 수 있어 간편하게 신뢰도 높은 실행환경 구축 가능

  

### Docker 주요 명령어 

- `docker build -t <image_name:tag> .` 
  - dockerfile과 이미지로 만들 파일들이 있는 디렉토리에서 실행하여 이미지 생성
  
- `docker tag <image_name(:tag)> <id/image_name:tag>`
  - 이미 생성한 이미지에 새로운 태그 부여
  - 하나의 이미지에 여러 개의 태그를 부여할 수 있음

- `docker push <id/image_name:tag> `
  - 내 dockerhub id에 연결되어 있는 원격 저장소에 이미지 push

- `docker pull  <id/image_name:tag>`
  - 내 원격저장소에서 이미지 pull

- `docker run <id/image_name:tag>`

  - `--name <container_name>` : 컨테이너 이름 지정
  - `-d` : detach. 백그라운드실행
  - `-p <외부포트>:<내부포트> :` 외부 호스트의 포트 : 컨테이너 내부 포트 포워딩
  - `--env-file <env파일 경로>` : 환경변수 설정

- `docker logs <container_name>`
  - `-f` : follow. 로그 실시간 출력
  
- `docker exec -it <container_name>` : 컨테이너 내부 접속

- `docker container stop` : 컨테이너 중지

- `docker container rm` : 컨테이너 삭제

- `docker image rm` : 이미지 삭제

- `docker container ls` : 컨테이너 목록 조회. `docker ps`도 됨.
  - `-a` : 종료된 컨테이너도 포함해서 전체 조회

- `docker image ls` : 이미지 목록 조회



## 실습

### Docker Desktop 설치 및 DockerHub 회원가입

- https://github.com/srogsrogi/TIL/blob/master/Lesson/how_to_install/docker.md



### Docker Desktop 둘러보기

- Image, Conatiner 탭 눌러보기
- Docker Hub 탭에서 공식 이미지 및 태그 확인하기

- GUI를 통해 Container run 실행하기
- log, inspect, exec 살펴보기



### 설정파일 읽어 보기

- wisheasy 프로젝트의 Dockerfile 읽어 보기
- .dockerignore 열어 보기



### CLI로 Docker 제어하기

- Docker 버전 확인
- 내가 만든 앱(wisheasy 프로젝트) Image build
- Image tag 붙이기
- DockerHub 로그인
- DockerHub에 push
- DockerHub에서 pull
- Container run
- Image / Conatiner 목록 확인
- Container log 확인

- Container 중지, 삭제



## Wrap-up Quiz

- VM과 Container를 비교하여 설명해보세요.
- Dockerfile에는 어떤 내용들이 있었나요?
- 컨테이너 안에서 실행된 서버에 오류가 생겼을 때 어떻게 로그를 확인할 수 있을까요?



## 강의 마무리

- VM, Container, Image 등 주요 개념을 온전히 이해하고 자신의 언어로 설명할 수 있어야 합니다.
  - 가상화에 대한 감각은 현대적 소프트웨어 개발의 초석이 됩니다.
- 개발과 디버깅을 해나가는 과정에서 내 코드와 명령어가 어디에서 실행되는지가 항상 머릿속에 그려져야 합니다.
  - GPT가 준 명령어를 어디에 입력해야 하는지 모르거나 엉뚱한 곳에 입력하는 자신을 발견한다면, 그 작업을 멈추고 시스템 아키텍쳐와 자신이 쓴 코드를 먼저 이해해야 합니다.

- 이제 여러분은 내가 개발한 서비스를 앱 단위로 격리하고 배포할 수 있게 되었습니다.
- 다음 시간에는 컨테이너를 실행할 서버 공간인 AWS EC2 서비스에 대해 배워보겠습니다.