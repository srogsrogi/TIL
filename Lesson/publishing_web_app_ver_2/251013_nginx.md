# Reverse Proxy와 Nginx



## 선수 지식

- 웹 서버와 클라이언트의 동작 방식에 대한 이해

- VM 및 Container 개념 이해 및 관련 도구 사용법 이해

  - AWS EC2 보안 그룹 설정
  - MobaXterm을 통한 SSH 접속

  - Docker Image build|push|pull, Container run

- CLI에 대한 이해



## 학습 목표

- Proxy의 개념과 필요성을 설명할 수 있다.
- Nginx의 핵심적인 역할 세 가지를 설명할 수 있다.
- 서버에 Nginx를 설치하고 설정 파일을 작성하여 요청을 애플리케이션 서버로 전달할 수 있다.



## Warm-up

- 시스템 아키텍쳐를 설명할 때, Nginx는 웹 서버의 문지기 같은 녀석이라고 여러 번 언급했는데요.
- 요청을 서버로 직접 전달해도 잘 작동하는데도, 여러분의 프로젝트에서는 Nginx를 설치해서 사용하고 있습니다.

- Nginx의 필요성과 역할에 대해 알아봅시다.



## 이론

### 프록시(Proxy)

- 클라이언트와 서버 사이에서 요청을 대신 받아 처리해주는 서버
- proxy의 종류
  - Forward Proxy : 서버 내부 사용자가 외부에 요청할 때 대신 요청을 처리
  - Reverse Proxy : 외부 사용자가 서버에 요청을 보내면 대신 내부서버에 요청을 보내고 결과 반환
- 보안성, 성능(속도), 확장성 개선에 기여
  - 보안성
    - 내부 구조 은닉
    - 보안 설정 중앙화
    - 특정 IP 차단, SSL 암호화 관리 등
  - 성능
    - C언어 기반으로 작성되어 데이터 처리 속도가 빠름
    - static files의 처리 속도를 높이기 위한 최적화가 잘 돼있음
  - 확장성 : 서버의 종류 등에 상관 없이 교체/수정해도 잘 돌아간다!



### Nginx

- 고성능 **Reverse Proxy** 서버
- 운영 환경에서 애플리케이션 서버(uvicorn/gunicorn) 앞단에 위치하여 요청을 관리하는 문지기 역할



### Nginx의 주요 역할

- **SSL/TLS 처리**
  - HTTPS 적용 시 인증서 관리 및 암호화 처리 담당
  - 앱 서버는 복잡한 SSL 설정 없이 내부 통신에 집중 가능
- **load balancing**
  - 여러 백엔드 서버로 트래픽을 분산시켜 성능과 안정성 향상
- **빠른 static files 제공**
  - C언어 사용 + 이벤트 기반 처리 -> 작업 최적화
  - 캐싱/버퍼링 -> 네트워크 전송 최적화



### Nginx 설정 파일

- 기본적으로 두 개의 설정 파일이 있음
  - `/etc/nginx/nginx.conf` : 전역 설정
  -  `/etc/nginx/sites-available/default` : 기본 서버블록 설정

- nginx가 실행되는 공간 내에 요청을 받을 서버가 하나 뿐이라면, `default`를 편집해서 사용

- 여러 서버가 서비스되고 있다면 `default`를 비활성화하고 개별 파일을 통해 설정해줘야 함



## 실습

- Docker CLI 및 AWS EC2 복습을 겸하여 진행
- html 페이지 렌더링하는 간단한 Django 앱 이미지 빌드
  - requirements.txt 작성
  - Dockerfile 작성
  - Docker build 및 DockerHub 배포

- EC2 인스턴스 접속

  - 인스턴스 생성
  - SSH 접속
  - `apt update`

- 웹 앱 컨테이너 실행

  - docker.io 설치

  - DockerHub 로그인
  - Image pull
  - Container run
  - IPv4 주소 접속 확인

- Nginx 설치 및 동작 확인

  - `apt install nginx`
  - `systemctl status nginx`
  - `curl http://localhost`
  - IPv4 주소 접속 확인(Nginx 기본 페이지 렌더링)

- 설정 파일 수정

  - `nano` 편집기를 통한 설정파일 수정

- 문법 검사 및 재시작

  - `nginx -t`
  - `systemctl restart nginx`

  - http 접속 확인(웹 앱 정상 실행)



## Wrap-up Quiz

- Proxy, 특히 Reverse Proxy의 개념을 설명해봅시다.
- Nginx의 핵심 기능 세 가지는 무엇인가요?
- 하고 계신 프로젝트의 시스템 아키텍쳐를 직접 그리고, 사용자의 요청에 따른 데이터의 흐름을 설명해봅시다.



## 강의 마무리

- 실습이 하고 계신 프로젝트의 구조와는 약간 다르게 진행되었습니다.
  - Nginx를 별도의 컨테이너에서 실행하지 않고 호스트 머신에 직접 설치했습니다.
  - 새로 배우는 내용이 많아 차시별 학습량을 조정하기 위함입니다.
  - 이후 차시에서 `docker compose` 기능과 함께 다시 다룰 예정입니다.

- 수업에서 실습 비중이 높아질수록, 금방 휘발되는 내용이 더 많아집니다.
  - 복습하며 내 손으로 다시 코드를 쳐보지 않으면 실습 내용 뿐만 아니라 개념도 같이 흩어집니다.
  - 토이 프로젝트나 실습용 코드를 만들어 실제 배포 경험을 가져보시기를 권합니다.