# Scope

- 변수가 선언되는 위치에 따라서 사용되는 위치도 다름
  - Local : 현재 함수 내
  - Enclosing : nested function 구조에서 현재 함수 바깥에 있는 함수의 변수(n중첩도 가능)
  - Global : 전역(모듈 전체)
  - Built-in : 파이썬 자체에 내장된 예약어들

- 변수가 호출되면, L-E-G-B순으로 나가면서 단계적으로 탐색
- 제일 먼저 만난 하나의 정의만 사용함



## 예제

```python
x = 'G'
y = 'G'

def outer_func():
	x = 'E'
	y = 'E'
	
	def inner_func():
	z = 'L'
	print(x,y,z)
	
	inner_func('P')
	print(x, y)
	
outer_func()
print(x, y)
```

1. outer_func()가 호출될 때 outer_func 함수가 실행된다.

2. outer_func 함수에서 x='E', y='E'로 할당하고 나서 inner_func(P)함수가 실행되면서 z='L', y='P'로 할당된 후 x(E),y(P),z(L)이 출력된다.

3. 그 후 outer_func의 마지막 부분이 실행되어 outer_func의 로컬 변수인 x(E), y(E)가 출력된다.

4. 마지막으로 print(x,y)가 실행되어 전역변수 x(G), y(G)가 출력된다.



## 질문/답변

- **Q1-1. `global (변수)`는 이 함수 내에서 전역변수를 조작할 경우 그 변경사항을 전역 scope로 내보내겠다는 설정인거지? 한번 하면 그 함수 내에서 계속 동작하는거고?**
  
  - 맞음. 함수 내에서 `global x`라고 선언하면, 이후 해당 함수 전체에서 `x`는 지역 변수가 아니라 전역 변수로 동작
  - 같은 함수 내에서 nonlocal로 했다가 밑에서 다시 global로 한다든지 그런 것도 불가능
  
- Q1-2. 반대로 전역에서 `nonlocal`이나 `local`을 선언하는건 불가능하겠네 그게 어딘지를 모르니까?

  - `nonlocal`은 반드시 중첩 함수 내부에서만 사용할 수 있음

  - 전역에서 가리키는 단 하나의 enclosing/local scope가 없기 때문에 사용할 수 없음

    

- **Q2-1. 왜 매개변수에는 `global` 키워드를 사용할 수 없는 거야?**

  - 함수의 매개변수는 정의되는 순간 자동으로 로컬 변수로 예약됨

  - 같은 이름에 대해 `global`이나 `nonlocal`을 선언하면 스코프 충돌로 `SyntaxError` 발생

- **Q2-2. 왜 매개변수가 로컬로 생성되어야 해? 실무에선 어차피 스코프가 달라도 변수명 다르게 쓰긴 하지?**
  
  - 인자가 지역 스코프에 있어야 즉시 접근 가능하기 때문
  - 실무에서는 변수명 다 다르게 하긴 하는데, 그건 사람이 하는 거고 언어 개발 철학은 또 별개지.
  
- **Q2-3. `def func(num):`을 하는 순간 `num`이 파라미터로 지정되고, 이후에 `nonlocal num`이나 `global num` 키워드를 주면 파라미터를 덮어버리지 않고 동시에 여러 개의 상태를 유지하게 되면서 오류가 나네?**
  
  - 같은 이름을 지역 변수(파라미터)와 전역/비지역 변수로 동시에 쓰면 명확하지 않은 참조가 발생하기 때문에 파이썬이 아예 정의 시점에 `SyntaxError`를 발생시켜.
  
- **Q2-4. 아예 중복해서 등록하지 못하게 했다면 `parameter면서 global이라서 안된다`는 오류메시지가 뜰 수가 없지. 하나의 변수에 두 스코프를 다 할당했기 때문에 오류메시지가 그렇게 뜰 수 있는 거 아냐?**
  
  - 맞음. symbol table에서 변수가 두 스코프에 중복 등록되었기 때문에 “parameter and global”이라는 명확한 충돌 메시지를 주는 거.
  
- **Q2-5. 각각 스코프에 등록은 오류 없이 이뤄지는데, 실제로 그 변수를 꺼내서 쓰려고 하는 순간 오류가 난다는 거야?**
  
  - ㄴㄴ. 실행 이전, 즉 정의 시점에서 이미 오류가 발생
  - 파이썬은 함수를 정의할 때 전체 코드를 정적으로 분석해서 충돌 여부를 판단하고 오류를 발생시킴
  
- **Q2-6. 그치, 아닐 거라고 생각했어. 왜냐면 접근하려는 순간 에러가 나는 거라면, 일단 정의하는 과정에서는 에러가 없어야 하고, 접근할 때는 어차피 가까운 로컬에서 변수를 찾으면 그 바깥 스코프는 참조를 시도하지 않기 때문에 오류가 나지 않아야 맞지?**
  
  - 그치. 파이썬은 정의할 때부터 충돌을 막아서 언어로서 신뢰성을 높임.
  
- **Q2-7. 정리하면, 함수를 정의하는 순간, 그게 실행되지는 않더라도 symbol table이라고 부르는 어떤 준비단계를 거치는데 함수 내에서 여러 스코프에 변수를 할당하면 그 과정에서 에러가 난다는 얘기네?**
  
  - 함수는 정의될 때 내부 코드가 컴파일되고, 이 과정에서 심벌 테이블(symbol table)이 생성됨
  - 이때 변수들의 스코프도 결정되는데, 충돌이 있으면 실행 전에 바로 `SyntaxError`가 발생